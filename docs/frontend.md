# 前端功能說明文檔

本專案前端採用 **Next.js 14** (App Router) 開發，使用 TypeScript 編寫，介面組件使用 **Tailwind CSS** 與 **Shadcn UI**。

## 核心頁面與功能

### 1. 登入/註冊頁面 (`AuthForm.tsx`)
- **入口管理**: 當用戶未登入時，所有頁面均會顯示此表單。
- **功能**:
    - 提供用戶登入與註冊功能。
    - 登入後將用戶資訊儲存於 `AppContext` 中。
    - 註冊時可自定義用戶名與密碼。

### 2. 占卜主頁 (`LiuYaoPage.tsx`)
這是專案的核心功能頁面，提供完整的六爻占卜流程。
- **解卦模式選擇**: 用戶可切換「Local AI」或「Gemini」作為解卦提供者。
- **占卜流程**:
    1. **輸入資訊**: 輸入問題、性別與占卜對象。
    2. **配置檢查**: 系統會主動檢查當前 AI 模式是否已配置密鑰或網址。
    3. **起卦 (搖卦)**: 模擬三次硬幣投擲，連續六次，生成「本卦」與「變卦」。
    4. **解卦**: 將卦象數據發送至後端，由 AI 生成詳細的解讀報告。
- **UI 特色**:
    - 動態背景效果與金色的進度追蹤。
    - 卦象結果的卡片式展示（包含六親、五行、地支、神煞等信息）。

### 3. 歷史記錄 (`history/page.tsx`)
- **列表展示**: 列出用戶所有的占卜記錄。
- **功能**:
    - **搜索與過濾**: 支持關鍵字搜索、收藏狀態過濾。
    - **管理員模式**: 管理員可以查看所有用戶的記錄，或按用戶名過濾。
    - **詳情查看**: 點擊記錄可彈窗查看完整的卦象與 AI 解讀。
    - **收藏與刪除**: 用戶可以對記錄進行收藏或刪除。
    - **Markdown 導出**: 提供一鍵複製功能，將問題與結果以 Markdown 格式複製到剪貼簿。
- **AI 思考過程**: 支持顯示/折疊 Local AI (如 DeepSeek) 的 `<think>` 思考標籤內容。

### 4. 設定頁面 (`settings/page.tsx`)
- **帳戶管理**: 修改密碼。
- **AI 設定**:
    - **Gemini**: 儲存 API Key 至雲端（加密儲存）或本地（localStorage）。
    - **Local AI**: 設定 API URL 分與模型名稱。
- **雲端備份**: 非管理員用戶可將自己的 Local AI 設定儲存至伺服器，實現多設備同步且不影響他人。
- **管理員專區**: 僅管理員可見，用於設定全域預設值（如每日限制、全域系統提示詞、全域預設模型等）。

### 5. 用戶管理 (`admin/page.tsx`)
- **功能**: 管理員可查看所有用戶列表。
- **操作**: 創建新用戶、修改密碼、刪除用戶、更改角色（admin/user）。

## 全域狀態管理 (`AppContext.tsx`)
- **User**: 儲存當前登入用戶資訊。
- **Settings**: 儲存全域系統設定。
- **BackendApiKeys**: 同步用戶在伺服器端儲存的加密 Key 或個人化 AI 配置。
- **History**: 管理緩存的歷史記錄。

## API 通訊 (`lib/api.ts`)
- 所有 API 調用均封裝在 `ApiClient` 類中。
- 支持 Cookie 認證與自定義 Header（如 X-Gemini-Api-Key）。
