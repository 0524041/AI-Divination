# 紫微斗數功能測試指南

## 測試前準備

1. **確保服務正在運行**:
   ```bash
   ./start.sh --status
   # 如果沒有運行，執行：
   ./start.sh
   ```

2. **確認 AI 服務已設定**:
   - 訪問 http://localhost:3000/settings
   - 確保至少有一個 AI 服務已配置（Gemini 或 Local AI）

---

## 完整測試流程

### 步驟 1: 登入系統

1. 訪問 http://localhost:3000
2. 如果自動跳轉到登入頁面，輸入帳號密碼登入
3. 登入後應該看到首頁，顯示歡迎訊息

### 步驟 2: 訪問紫微斗數頁面

**方法一：從首頁點擊**
- 在首頁找到「紫微斗數」卡片（星星圖標 ⭐）
- 點擊卡片進入紫微斗數頁面
- 確認卡片不再顯示 "Coming Soon" 標籤

**方法二：直接訪問**
- 訪問 http://localhost:3000/ziwei

**預期結果**:
- 應該看到紫微斗數介紹頁面
- 有「開始排盤」按鈕

### 步驟 3: 輸入生辰八字

1. 點擊「開始排盤」按鈕
2. 填寫以下資訊：
   - **姓名**: 測試用戶
   - **性別**: 選擇男或女
   - **出生日期時間**: 選擇任意日期和時間（例如：1990-01-01 12:00）
   - **出生地**: 從下拉選單選擇台灣縣市（例如：台北市）
   - **雙胞胎**: 可以測試勾選/不勾選
     - 如果勾選，會出現「出生順序」選項

3. **測試儲存功能**:
   - 點擊「💾 儲存」按鈕
   - 應該看到「儲存成功！」提示

4. **測試讀取功能**:
   - 重新進入輸入頁面
   - 從「選擇已儲存的生辰八字」下拉選單選擇剛才儲存的資料
   - 確認所有欄位自動填入

5. **測試刪除功能**:
   - 選擇一筆已儲存的資料
   - 點擊「🗑️ 刪除此紀錄」按鈕
   - 確認刪除提示，點擊確定
   - 確認資料已從下拉選單中消失

6. 點擊「下一步：問卦」

### 步驟 4: 問卦

1. **選擇問卦類型**:
   - **本命**：一生情況（預設）
   - **流年**：指定年份運勢
   - **流月**：指定月份運勢
   - **流日**：指定日期運勢

2. **如果選擇流年/流月/流日**:
   - 輸入查詢日期
   - 例如：流年選擇 2024，流月選擇 2024-01，流日選擇 2024-01-15

3. **輸入問題**:
   - 在輸入框輸入問題，例如：「我今年的事業運勢如何？」
   - 問題應與選擇的問卦類型相關

4. **確認 AI 已選擇**:
   - 頁面上方應該有 AI 選擇器
   - 確認已選擇一個 AI 服務

5. 點擊「送出」按鈕

### 步驟 5: 查看 AI 解讀結果

1. **等待 AI 解讀**:
   - 應該看到加載動畫（⏳ 圖標旋轉）
   - 顯示「AI 解讀中，請稍候...」訊息

2. **查看解讀結果**:
   - 等待數秒到數十秒（取決於 AI 服務）
   - 應該看到 AI 解讀內容
   - 內容應該是 Markdown 格式渲染的文字

3. **測試導航**:
   - 點擊「查看歷史紀錄」按鈕
   - 應該跳轉到歷史紀錄頁面

### 步驟 6: 查看歷史紀錄

1. 訪問 http://localhost:3000/history
2. 在歷史紀錄列表中找到剛才的紫微斗數占卜記錄
3. **確認顯示內容**:
   - 類型應該顯示「紫微斗數」
   - 顯示問題內容
   - 顯示日期時間
   - 顯示狀態（完成/處理中/錯誤）

4. **測試展開/收合**:
   - 點擊記錄展開詳細內容
   - 確認 AI 解讀結果正確顯示

---

## 特殊測試案例

### 測試 1: 雙胞胎功能

1. 輸入生辰八字時勾選「雙胞胎」
2. 選擇「老大（先出生）」
3. 完成問卦流程
4. 再次輸入**相同生辰八字**，但選擇「老二（後出生）」
5. 確認兩次排盤結果不同（對宮法應用）

### 測試 2: 不同問卦類型

依次測試：
- 本命問卦（不需日期）
- 流年問卦（選擇年份，例如 2024）
- 流月問卦（選擇月份，例如 2024-01）
- 流日問卦（選擇日期，例如 2024-01-15）

確認每種類型都能正常生成解讀。

### 測試 3: 真太陽時校正

1. 選擇不同縣市進行問卦：
   - 台北市
   - 高雄市
   - 台東縣
2. 使用相同的生辰八字時間（例如 12:00）
3. 確認不同地點的時辰可能不同（因為經度差異）

### 測試 4: 錯誤處理

1. **不輸入問題直接送出**:
   - 應該看到「請輸入問題」提示

2. **AI 服務未設定**:
   - 如果 AI 服務未配置，應該看到提示訊息

---

## 驗證重點

### ✅ 功能性測試
- [ ] 首頁紫微斗數卡片可點擊
- [ ] 生辰八字輸入所有欄位正常
- [ ] 儲存/讀取/刪除生辰八字功能正常
- [ ] 台灣縣市下拉選單顯示完整
- [ ] 雙胞胎選項顯示/隱藏邏輯正確
- [ ] 四種問卦類型都能正常使用
- [ ] AI 解讀能正常生成
- [ ] 歷史紀錄正確顯示紫微斗數類型

### ✅ UI/UX 測試
- [ ] 所有按鈕樣式一致
- [ ] 載入動畫正常顯示
- [ ] 錯誤訊息清晰易懂
- [ ] 表單驗證提示明確
- [ ] 響應式設計（手機/平板/電腦）

### ✅ 整合測試
- [ ] 紫微斗數與六爻/塔羅不互相干擾
- [ ] 歷史紀錄頁面支援三種占卜類型
- [ ] 設定頁面的 AI 配置對紫微斗數有效

---

## 已知問題/限制

1. **AI 回應時間**: 本地 AI 可能需要較長時間（1-3 分鐘）
2. **真太陽時校正**: 僅支援台灣地區
3. **UI 簡化**: 第一版使用簡單文字/表格展示，無複雜圖表

---

## 測試完成標準

所有上述測試案例都能正常運作，無阻塞性錯誤即視為測試通過。

如有問題，請記錄：
- 問題描述
- 重現步驟
- 錯誤訊息（如有）
- 瀏覽器控制台錯誤（F12 開啟）
