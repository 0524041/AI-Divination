# ichingshifa 套件與本系統的對照說明

## 安裝 ichingshifa

```bash
pip install sxtwl
pip install ichingshifa
```

## 起卦方法對照

### 1. 數字格式對照

| 爻性質 | ichingshifa | 本系統 | 說明 |
|--------|-------------|--------|------|
| 老陰（動） | 6 | 3 | 三個背面 |
| 少陽（靜） | 7 | 1 | 兩正一反 |
| 少陰（靜） | 8 | 2 | 一正兩反 |
| 老陽（動） | 9 | 0 | 三個正面 |

### 2. 起卦方法對照

| 方法 | ichingshifa | 本系統 |
|------|-------------|--------|
| 手動輸入 | `Iching().mget_bookgua_details('789789')` | `get_divination(yaogua=[1,2,3,0,1,2])` |
| 隨機起卦 | `Iching().bookgua_details()` | `get_divination()` |
| 指定時間 | `Iching().datetime_bookgua(年,月,日,時)` | `get_divination(year, month, day, hour, minute)` |

## 輸出格式對照

### ichingshifa 輸出結構

```python
{
    '日期': '辛丑年戊戌月庚寅日甲申時',
    '大衍筮法': ['887888', '謙', '謙', {卦辭}, (動爻說明)],
    '本卦': {
        '卦': '謙',
        '世應卦': '五世卦',
        '地支': ['辰', '午', '申', '丑', '亥', '酉'],
        '五行': ['土', '火', '金', '土', '水', '金'],
        '六親用神': ['父', '官', '兄', '父', '子', '兄'],
        '六獸': ['虎', '武', '龍', '雀', '陳', '蛇'],
        '納甲': ['丙辰', '丙午', '丙申', '癸丑', '癸亥', '癸酉'],
        ...
    },
    '之卦': {...}
}
```

### 本系統輸出結構

```python
{
    'yaogua': [1, 2, 3, 0, 1, 2],
    'time': '2025-12-29 14:30:00',
    'bazi': '乙巳 戊子 丙寅 乙未',
    'kongwang': '辰巳',
    'guashen': '離',
    'benguaming': '火水未濟',
    'bianguaming': '山風蠱',
    'shensha': [{'name': '驛馬', 'zhi': ['申']}, ...],
    'yao_1': {
        'liushen': '青龍',
        'origin': {
            'relative': '子孫',
            'zhi': '寅',
            'wuxing': '木',
            'line': '⚋',
            'is_subject': False,
            'is_object': False,
            'is_changed': False
        }
    },
    ...
}
```

## 主要差異

### 1. 起卦方法
- **ichingshifa**: 大衍筮法（50根蓍草，更複雜）
- **本系統**: 硬幣法（簡化版，等機率）

### 2. 納甲系統
- **ichingshifa**: 完整的天干地支納甲
- **本系統**: 僅地支納甲

### 3. 世應卦
- **ichingshifa**: 包含遊魂卦、歸魂卦標註
- **本系統**: 僅標註幾世卦（1-6世）

### 4. 六親簡寫
- **ichingshifa**: 父、官、兄、妻、子
- **本系統**: 父母、官鬼、兄弟、妻財、子孫

### 5. 六獸
- **ichingshifa**: 虎、武、龍、雀、陳、蛇
- **本系統**: 白虎、玄武、青龍、朱雀、勾陳、螣蛇

### 6. 額外功能
- **ichingshifa**: 
  - 伏神飛神
  - 積算
  - 建月
  - 主客勝負分析
- **本系統**: 
  - 僅基礎排盤
  - 神煞（驛馬、桃花）

## 使用比較工具

### 基本用法

```bash
# 測試單個案例
python test_tools/compare_with_ichingshifa.py --yaogua 789789

# 批量測試
python test_tools/compare_with_ichingshifa.py --batch

# 互動式測試
python test_tools/compare_with_ichingshifa.py --interactive
```

### 預期結果

| 比較項目 | 預期結果 | 說明 |
|---------|---------|------|
| 卦名 | ✅ 應該一致 | 本卦、變卦名稱 |
| 納甲（地支） | ❓ 可能有差異 | 納甲規則可能不同 |
| 六親 | ❓ 可能有差異 | 取決於卦宮判斷 |
| 世應卦 | ❓ 可能有差異 | 尋宮安世算法可能不同 |
| 卦宮 | ❓ 無法比較 | ichingshifa 未直接提供 |

## 注意事項

1. **起卦方法不同**：ichingshifa 的大衍筮法與硬幣法在機率分佈上有差異
2. **納甲傳統不同**：不同流派的納甲規則可能有細微差異
3. **世應判斷**：尋宮安世算法在不同傳統中可能有所不同
4. **用途不同**：ichingshifa 更偏向學術研究，本系統更偏向實用占卜

## 測試案例建議

| 案例 | ichingshifa | 本系統 | 說明 |
|------|-------------|--------|------|
| 八純卦 | 777777 | [1,1,1,1,1,1] | 乾為天 |
| 有動爻 | 788988 | [2,1,3,0,2,1] | 火水未濟 |
| 多動爻 | 989898 | [0,2,0,2,0,2] | 測試變卦 |
| 遊魂卦 | 787888 | [2,1,2,1,2,2] | 地火明夷 |

## 參考資料

- ichingshifa 文檔: https://github.com/kentang2017/ichingshifa
- 六爻排盤傳統: 京房易學、火珠林法
- 納甲規則: 《易隱》、《黃金策》、《增刪卜易》
